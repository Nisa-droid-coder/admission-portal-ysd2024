<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Young Scientist Day 2026 UPM - Ticket Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1a4c8c, #2c6cb0);
            color: white;
            padding: 25px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
            position: relative;
            overflow: hidden;
        }
        
        .header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"><path fill="white" d="M50,5 L60,40 L95,40 L65,60 L75,95 L50,75 L25,95 L35,60 L5,40 L40,40 Z"/></svg>');
            background-size: 150px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Add your actual logo here */
        .logo-real {
            width: 80px;
            height: 80px;
            background-image: url('your-logo-url-here.png'); /* Replace with your logo */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .logo-text h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .logo-text p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .event-date {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .event-date p {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .ticket-steps {
            display: flex;
            justify-content: center;
            margin: 30px 0 40px;
            position: relative;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            width: 200px;
        }
        
        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            border: 4px solid white;
            box-shadow: 0 0 0 3px #ddd;
            transition: all 0.3s ease;
        }
        
        .step.active .step-circle {
            background-color: #2c6cb0;
            color: white;
            box-shadow: 0 0 0 3px #2c6cb0;
        }
        
        .step.completed .step-circle {
            background-color: #1a4c8c;
            color: white;
            box-shadow: 0 0 0 3px #1a4c8c;
        }
        
        .step.completed .step-circle::after {
            content: 'âœ“';
        }
        
        .step-line {
            position: absolute;
            top: 25px;
            left: 50%;
            width: 100%;
            height: 4px;
            background-color: #ddd;
            z-index: 0;
        }
        
        .step:first-child .step-line {
            width: 50%;
            left: 50%;
        }
        
        .step:last-child .step-line {
            width: 50%;
            left: 0;
        }
        
        .step-text {
            font-weight: 500;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .main-content {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
            min-height: 400px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .ticket-option {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        
        .ticket-option:hover {
            border-color: #2c6cb0;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(44, 108, 176, 0.1);
        }
        
        .ticket-option h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .ticket-option p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .ticket-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c6cb0;
            margin-bottom: 10px;
        }
        
        .promo-badge {
            display: inline-block;
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .promo-text {
            color: #ff9800;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #fff8e1;
            border-radius: 4px;
            border-left: 4px solid #ff9800;
        }
        
        .note {
            background-color: #f9f9f9;
            border-left: 4px solid #2c6cb0;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.95rem;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #2c6cb0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1a4c8c;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        
        .quantity-btn {
            width: 40px;
            height: 40px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-btn:hover {
            background-color: #e0e0e0;
        }
        
        .quantity-input {
            width: 60px;
            height: 40px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 0 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .total-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            border-left: 4px solid #2c6cb0;
        }
        
        .total-label {
            font-weight: 600;
            color: #666;
        }
        
        .total-amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .form-group label .required {
            color: #e53935;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #2c6cb0;
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 108, 176, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .participant-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
        }
        
        .participant-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .participant-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .participant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .remove-participant {
            background-color: #e53935;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ticket-preview {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            border: 1px dashed #ccc;
        }
        
        .ticket-preview h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .preview-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-label {
            font-weight: 600;
            color: #666;
        }
        
        .preview-value {
            color: #333;
            font-weight: 500;
        }
        
        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .payment-method {
            flex: 1;
            min-width: 200px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-method:hover {
            border-color: #2c6cb0;
            background-color: rgba(44, 108, 176, 0.05);
        }
        
        .payment-method.selected {
            border-color: #2c6cb0;
            background-color: rgba(44, 108, 176, 0.1);
        }
        
        .payment-method i {
            font-size: 2.5rem;
            color: #2c6cb0;
            margin-bottom: 15px;
        }
        
        .success-message {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 5rem;
            color: #2c6cb0;
            margin-bottom: 20px;
        }
        
        .success-message h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .booking-id {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c6cb0;
            letter-spacing: 2px;
            margin: 20px 0;
            padding: 10px;
            background-color: #f0f7ff;
            border-radius: 5px;
            display: inline-block;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        .data-storage-note {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 30px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .logo-container {
                flex-direction: column;
            }
            
            .step {
                width: 120px;
            }
            
            .step-text {
                font-size: 0.8rem;
            }
            
            .ticket-option {
                padding: 20px;
            }
            
            .payment-method {
                min-width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-bg"></div>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <!-- Replace with your actual logo -->
                    <div class="logo-placeholder">
                        <i class="fas fa-microscope"></i>
                    </div>
                    <!-- Or use this if you have a logo image -->
                    <!-- <div class="logo-real"></div> -->
                    
                    <div class="logo-text">
                        <h1>Young Scientist Day 2026</h1>
                        <p>Universiti Putra Malaysia | YSD2026 UPM</p>
                    </div>
                </div>
                <div class="event-date">
                    <p><i class="far fa-calendar-alt"></i> Event Date: 13th June 2026</p>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="ticket-steps">
            <div class="step completed" id="step1">
                <div class="step-circle">1</div>
                <div class="step-text">Select Ticket</div>
                <div class="step-line"></div>
            </div>
            <div class="step active" id="step2">
                <div class="step-circle">2</div>
                <div class="step-text">Booking Options</div>
                <div class="step-line"></div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-text">Complete Booking</div>
                <div class="step-line"></div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">4</div>
                <div class="step-text">Payment</div>
                <div class="step-line"></div>
            </div>
            <div class="step" id="step5">
                <div class="step-circle">5</div>
                <div class="step-text">Confirmation</div>
                <div class="step-line"></div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Page 1: Select Ticket -->
            <div class="page active" id="page1">
                <h2>Select Admission Ticket</h2>
                <p class="note"><i class="fas fa-info-circle"></i> Free cancellation before redemption | Age verification required at entrance</p>
                
                <div class="ticket-option">
                    <h3>Kids (5 to 12 years of age)</h3>
                    <p>Admission ticket for children between 5 to 12 years old. Includes access to all YSD2026 activities, experiments, and workshops at Universiti Putra Malaysia.</p>
                    
                    <div class="ticket-price">RM 60.00 <span class="promo-badge">PROMO</span></div>
                    <div class="promo-text"><i class="fas fa-gift"></i> Special Offer: Book 3 tickets for only RM 180 (Regular price: RM 180)</div>
                    
                    <button class="btn btn-primary" onclick="selectTicket()">SELECT TICKET</button>
                </div>
                
                <div class="note">
                    <p><strong>Note:</strong> When you click SELECT, it will go to the booking options page.</p>
                </div>
            </div>
            
            <!-- Page 2: Booking Options -->
            <div class="page" id="page2">
                <h2>Booking Options</h2>
                
                <div class="ticket-option">
                    <h3>Kids (5 to 12 years of age)</h3>
                    <p>Admission ticket for children between 5 to 12 years old.</p>
                    <div class="ticket-price">RM 60.00</div>
                    
                    <div class="promo-text" id="promoMessage" style="display: none;">
                        <i class="fas fa-gift"></i> You're getting our special rate of RM 60 per ticket!
                    </div>
                    
                    <div class="quantity-selector">
                        <label>Select Quantity (Minimum 1, Maximum 10):</label>
                        <div style="display: flex; align-items: center; margin-top: 10px;">
                            <button class="quantity-btn" onclick="decreaseQuantity()">-</button>
                            <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="10">
                            <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                        </div>
                        <p style="margin-top: 10px; color: #666; font-size: 0.9rem;"><i class="fas fa-info-circle"></i> Can book as many numbers possible. Special rate applies automatically.</p>
                    </div>
                    
                    <div class="total-section">
                        <div class="total-label">Total Amount</div>
                        <div class="total-amount" id="totalAmount">RM 60.00</div>
                        <div id="regularPrice" style="color: #999; font-size: 0.9rem; text-decoration: line-through;"></div>
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" onclick="goToPage(1)">Back</button>
                        <div>
                            <button class="btn btn-secondary" onclick="addToCart()">ADD TO CART</button>
                            <button class="btn btn-primary" onclick="bookNow()">BOOK NOW</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page 3: Complete Booking -->
            <div class="page" id="page3">
                <h2>Complete Booking</h2>
                <p class="note"><i class="fas fa-ticket-alt"></i> YSD2026 Universiti Putra Malaysia Ticket</p>
                
                <h3 style="margin-bottom: 20px; color: #2c3e50;">Contact Person Details</h3>
                
                <div class="form-group">
                    <label for="contactName">Contact Person (Mother/Father/Guardian) <span class="required">*</span></label>
                    <input type="text" id="contactName" class="form-control" placeholder="Enter full name">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactEmail">Email Address <span class="required">*</span></label>
                        <input type="email" id="contactEmail" class="form-control" placeholder="Enter email address">
                    </div>
                    
                    <div class="form-group">
                        <label for="contactPhone">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="contactPhone" class="form-control" placeholder="Enter phone number">
                    </div>
                </div>
                
                <div class="participant-section">
                    <h3><i class="fas fa-child"></i> Participant Details (for certificate preparation)</h3>
                    <p style="color: #666; margin-bottom: 20px;">Please fill in the details of each child participating. This information will be used for certificate preparation.</p>
                    
                    <div id="participantsContainer">
                        <!-- Participant cards will be added here dynamically -->
                    </div>
                    
                    <button class="btn btn-secondary" onclick="addParticipant()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Another Participant
                    </button>
                </div>
                
                <div class="ticket-preview">
                    <h4>Booking Summary</h4>
                    <div class="preview-item">
                        <span class="preview-label">Ticket Type:</span>
                        <span class="preview-value">Kids (5 to 12 years of age)</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Event Date:</span>
                        <span class="preview-value">13th June 2026</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Number of Participants:</span>
                        <span class="preview-value" id="previewQuantity">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Total Amount:</span>
                        <span class="preview-value" id="previewTotal">RM 60.00</span>
                    </div>
                </div>
                
                <div class="data-storage-note">
                    <p><strong><i class="fas fa-database"></i> Data Storage Information:</strong> All participant information is securely stored in our system and linked to your email address. After payment, you will receive a confirmation email with all details. Certificate data will be processed from this information.</p>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-secondary" onclick="goToPage(2)">Back</button>
                    <button class="btn btn-primary" onclick="goToPayment()">GO TO PAYMENT</button>
                </div>
                
                <p style="margin-top: 20px; color: #666; font-size: 0.9rem; text-align: center;">
                    <i class="fas fa-info-circle"></i> Clicking "Go to Payment" will directly go to FPX UPM
                </p>
            </div>
            
            <!-- Page 4: Payment -->
            <div class="page" id="page4">
                <h2>Payment</h2>
                <p>Complete your payment using FPX (Financial Process Exchange) UPM</p>
                
                <div class="ticket-preview">
                    <h4>Payment Summary</h4>
                    <div class="preview-item">
                        <span class="preview-label">Contact Person:</span>
                        <span class="preview-value" id="paymentName">-</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Number of Participants:</span>
                        <span class="preview-value" id="paymentParticipants">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Amount to Pay:</span>
                        <span class="preview-value" id="paymentAmount">RM 60.00</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Booking Reference:</span>
                        <span class="preview-value" id="paymentReference">YSD-2026-001</span>
                    </div>
                </div>
                
                <h3 style="margin: 30px 0 20px;">Select Payment Method</h3>
                
                <div class="payment-methods">
                    <div class="payment-method selected" onclick="selectPayment('fpx')">
                        <i class="fas fa-university"></i>
                        <h4>FPX UPM</h4>
                        <p>Direct bank transfer via FPX</p>
                    </div>
                    <div class="payment-method" onclick="selectPayment('card')">
                        <i class="far fa-credit-card"></i>
                        <h4>Credit/Debit Card</h4>
                        <p>Visa, Mastercard, etc.</p>
                    </div>
                    <div class="payment-method" onclick="selectPayment('ewallet')">
                        <i class="fas fa-mobile-alt"></i>
                        <h4>E-Wallet</h4>
                        <p>Touch 'n Go, GrabPay, etc.</p>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-secondary" onclick="goToPage(3)">Back</button>
                    <button class="btn btn-primary" onclick="processPayment()">PAY NOW</button>
                </div>
                
                <div class="note" style="margin-top: 30px;">
                    <p><strong>Note:</strong> After purchasing ticket, the admission ticket with participant details will be sent to your email. Participant information will be used for certificate preparation.</p>
                </div>
                
                <div class="data-storage-note">
                    <p><strong><i class="fas fa-cloud"></i> How data is stored:</strong> All information is stored securely in our database and linked to your email. You can access your booking details anytime by clicking the link in your confirmation email. For certificate preparation, participant names and IC numbers will be extracted from this data.</p>
                </div>
            </div>
            
            <!-- Page 5: Confirmation -->
            <div class="page" id="page5">
                <div class="success-message">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Booking Successful!</h2>
                    <p>Your admission ticket for YSD2026 UPM has been booked successfully.</p>
                    <p>The admission ticket with participant details will be sent to your email shortly.</p>
                    
                    <div class="booking-id" id="confirmationRef">YSD-2026-001</div>
                    
                    <div class="ticket-preview" style="max-width: 600px; margin: 30px auto;">
                        <h4>Admission Ticket YSD2026 UPM</h4>
                        <div class="preview-item">
                            <span class="preview-label">Contact Person:</span>
                            <span class="preview-value" id="confirmationContact">-</span>
                        </div>
                        <div class="preview-item">
                            <span class="preview-label">Date Purchased:</span>
                            <span class="preview-value" id="confirmationDate">-</span>
                        </div>
                        <div class="preview-item">
                            <span class="preview-label">Number of Participants:</span>
                            <span class="preview-value" id="confirmationQuantity">1</span>
                        </div>
                        <div class="preview-item">
                            <span class="preview-label">Booking Reference ID:</span>
                            <span class="preview-value" id="confirmationBookingRef">-</span>
                        </div>
                    </div>
                    
                    <div id="participantsSummary" style="max-width: 600px; margin: 20px auto; text-align: left;">
                        <!-- Participant summary will be added here -->
                    </div>
                    
                    <div class="data-storage-note" style="max-width: 600px; margin: 20px auto;">
                        <p><strong><i class="fas fa-envelope"></i> What happens next:</strong> You will receive an email confirmation with all participant details. This data is securely stored and will be used for certificate preparation. Keep your booking reference for any inquiries.</p>
                    </div>
                    
                    <p style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="printTicket()"><i class="fas fa-print"></i> Print Ticket</button>
                        <button class="btn btn-secondary" onclick="goToPage(1)"><i class="fas fa-home"></i> Book More Tickets</button>
                    </p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Young Scientist Day 2026 | Universiti Putra Malaysia &copy; 2026. All rights reserved.</p>
            <p>For inquiries, contact: ysd2026@upm.edu.my | +603-9769 1234</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">All participant data is stored securely and used only for event administration and certificate preparation.</p>
        </footer>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
    // Initialize Supabase - REPLACE WITH YOUR ACTUAL CREDENTIALS
    const supabaseUrl = 'https://ueskudyzqiwjtskrrmji.supabase.co'; // Replace with your actual URL
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlc2t1ZHl6cWl3anRza3JybWppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MTg2NzIsImV4cCI6MjA4NjE5NDY3Mn0.I8jcbP1oMWIAn9DvCG4CnVxA6rd4tGI71siHkNrQuUI'; // Replace with your actual anon key
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    
    // Current page state
    let currentPage = 1;
    let ticketQuantity = 1;
    const ticketPrice = 60.00; // Promotional price
    const regularPrice = 60.00; // Regular price (same in this case)
    let selectedPayment = 'fpx';
    let participants = [];
    let currentBookingId = null;
    
    // DOM elements
    const quantityInput = document.getElementById('quantity');
    const totalAmountElement = document.getElementById('totalAmount');
    const regularPriceElement = document.getElementById('regularPrice');
    const promoMessageElement = document.getElementById('promoMessage');
    const previewQuantityElement = document.getElementById('previewQuantity');
    const previewTotalElement = document.getElementById('previewTotal');
    const paymentNameElement = document.getElementById('paymentName');
    const paymentParticipantsElement = document.getElementById('paymentParticipants');
    const paymentAmountElement = document.getElementById('paymentAmount');
    const paymentReferenceElement = document.getElementById('paymentReference');
    const confirmationContactElement = document.getElementById('confirmationContact');
    const confirmationDateElement = document.getElementById('confirmationDate');
    const confirmationQuantityElement = document.getElementById('confirmationQuantity');
    const confirmationBookingRefElement = document.getElementById('confirmationBookingRef');
    const confirmationRefElement = document.getElementById('confirmationRef');
    const participantsContainer = document.getElementById('participantsContainer');
    const participantsSummary = document.getElementById('participantsSummary');
    
    // Generate unique booking reference
    function generateBookingReference() {
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const random = Math.floor(1000 + Math.random() * 9000);
        return `YSD${year}${month}${day}${random}`;
    }
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        updateTotalAmount();
        updateStepIndicators();
        addParticipant(); // Add first participant by default
        
        // Generate initial booking reference
        const bookingRef = generateBookingReference();
        paymentReferenceElement.textContent = bookingRef;
    });
    
    // Navigation functions
    function goToPage(pageNumber) {
        // Hide current page
        document.getElementById(`page${currentPage}`).classList.remove('active');
        
        // Show new page
        document.getElementById(`page${pageNumber}`).classList.add('active');
        
        // Update current page
        currentPage = pageNumber;
        
        // Update step indicators
        updateStepIndicators();
        
        // Scroll to top
        window.scrollTo(0, 0);
        
        // Update participant count on page 3
        if (pageNumber === 3) {
            updateParticipantForms();
        }
    }
    
    function updateStepIndicators() {
        // Reset all steps
        for (let i = 1; i <= 5; i++) {
            const stepElement = document.getElementById(`step${i}`);
            stepElement.classList.remove('active', 'completed');
            
            if (i < currentPage) {
                stepElement.classList.add('completed');
            } else if (i === currentPage) {
                stepElement.classList.add('active');
            }
        }
    }
    
    // Page 1: Select Ticket
    function selectTicket() {
        goToPage(2);
    }
    
    // Page 2: Booking Options
    function increaseQuantity() {
        if (ticketQuantity < 10) {
            ticketQuantity = parseInt(quantityInput.value) + 1;
            quantityInput.value = ticketQuantity;
            updateTotalAmount();
        }
    }
    
    function decreaseQuantity() {
        if (ticketQuantity > 1) {
            ticketQuantity = parseInt(quantityInput.value) - 1;
            quantityInput.value = ticketQuantity;
            updateTotalAmount();
        }
    }
    
    function updateTotalAmount() {
        ticketQuantity = parseInt(quantityInput.value);
        const total = ticketQuantity * ticketPrice;
        totalAmountElement.textContent = `RM ${total.toFixed(2)}`;
        
        // Show/hide promo message
        if (ticketQuantity >= 3) {
            promoMessageElement.style.display = 'block';
        } else {
            promoMessageElement.style.display = 'none';
        }
        
        // Update preview on page 3
        previewQuantityElement.textContent = ticketQuantity;
        previewTotalElement.textContent = `RM ${total.toFixed(2)}`;
        
        // Update payment amount on page 4
        paymentAmountElement.textContent = `RM ${total.toFixed(2)}`;
        paymentParticipantsElement.textContent = ticketQuantity;
        
        // Update confirmation quantity on page 5
        confirmationQuantityElement.textContent = ticketQuantity;
    }
    
    function bookNow() {
        // Validate quantity
        if (ticketQuantity < 1 || ticketQuantity > 10) {
            alert('Please select between 1 to 10 tickets.');
            return;
        }
        
        goToPage(3);
    }
    
    function addToCart() {
        alert(`Added ${ticketQuantity} ticket(s) to cart! Total: RM ${(ticketQuantity * ticketPrice).toFixed(2)}`);
    }
    
    // Page 3: Complete Booking - Participant Management
    function addParticipant() {
        // Check if we've reached the ticket quantity limit
        if (participants.length >= ticketQuantity) {
            alert(`You can only add ${ticketQuantity} participant(s) based on your ticket quantity.`);
            return;
        }
        
        const participantId = participants.length + 1;
        participants.push({
            id: participantId,
            name: '',
            icNumber: '',
            age: ''
        });
        
        renderParticipantForms();
    }
    
    function removeParticipant(id) {
        participants = participants.filter(p => p.id !== id);
        // Reassign IDs
        participants.forEach((p, index) => {
            p.id = index + 1;
        });
        renderParticipantForms();
    }
    
    function updateParticipant(id, field, value) {
        const participant = participants.find(p => p.id === id);
        if (participant) {
            participant[field] = value;
        }
    }
    
    function renderParticipantForms() {
        participantsContainer.innerHTML = '';
        
        participants.forEach(participant => {
            const participantCard = document.createElement('div');
            participantCard.className = 'participant-card';
            participantCard.innerHTML = `
                <div class="participant-header">
                    <h4>Participant ${participant.id}</h4>
                    ${participant.id > 1 ? `<button class="remove-participant" onclick="removeParticipant(${participant.id})"><i class="fas fa-times"></i></button>` : ''}
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="participantName${participant.id}">Full Name <span class="required">*</span></label>
                        <input type="text" id="participantName${participant.id}" class="form-control" placeholder="Enter participant's full name" 
                               value="${participant.name}" onchange="updateParticipant(${participant.id}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label for="participantIC${participant.id}">IC/Passport Number <span class="required">*</span></label>
                        <input type="text" id="participantIC${participant.id}" class="form-control" placeholder="e.g., 123456-01-1234" 
                               value="${participant.icNumber}" onchange="updateParticipant(${participant.id}, 'icNumber', this.value)">
                    </div>
                </div>
                <div class="form-group">
                    <label for="participantAge${participant.id}">Age <span class="required">*</span></label>
                    <input type="number" id="participantAge${participant.id}" class="form-control" placeholder="Enter age (5-12)" min="5" max="12"
                           value="${participant.age}" onchange="updateParticipant(${participant.id}, 'age', this.value)">
                </div>
            `;
            participantsContainer.appendChild(participantCard);
        });
        
        // Update the "Add Another Participant" button visibility
        const addButton = document.querySelector('button[onclick="addParticipant()"]');
        if (participants.length >= ticketQuantity) {
            addButton.style.display = 'none';
        } else {
            addButton.style.display = 'inline-block';
        }
    }
    
    function updateParticipantForms() {
        // If we have more participants than tickets, remove the excess
        while (participants.length > ticketQuantity) {
            participants.pop();
        }
        
        // If we have fewer participants than tickets, add more
        while (participants.length < ticketQuantity) {
            addParticipant();
        }
        
        renderParticipantForms();
    }
    
    // Updated goToPayment function with Supabase integration
    async function goToPayment() {
        // Get contact person details
        const contactName = document.getElementById('contactName').value.trim();
        const contactEmail = document.getElementById('contactEmail').value.trim();
        const contactPhone = document.getElementById('contactPhone').value.trim();
        
        // Simple validation
        if (!contactName || !contactEmail || !contactPhone) {
            alert('Please fill in all contact person details.');
            return;
        }
        
        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(contactEmail)) {
            alert('Please enter a valid email address.');
            return;
        }
        
        // Validate participants
        let validParticipants = true;
        participants.forEach((p, index) => {
            if (!p.name || !p.icNumber || !p.age) {
                validParticipants = false;
            }
            if (p.age < 5 || p.age > 12 || isNaN(p.age)) {
                alert(`Participant ${index + 1} must be between 5-12 years old.`);
                validParticipants = false;
            }
        });
        
        if (!validParticipants) {
            alert('Please fill in all participant details correctly. All participants must be 5-12 years old.');
            return;
        }
        
        // Show loading state
        const submitBtn = document.querySelector('[onclick="goToPayment()"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;
        
        try {
            const bookingRef = generateBookingReference();
            const totalAmount = ticketQuantity * ticketPrice;
            
            // 1. Save contact person
            const { data: contactData, error: contactError } = await supabase
                .from('contact_persons')
                .upsert({
                    email: contactEmail,
                    full_name: contactName,
                    phone: contactPhone,
                    created_at: new Date().toISOString()
                }, {
                    onConflict: 'email'
                })
                .select()
                .single();
            
            if (contactError) {
                console.error('Contact save error:', contactError);
                throw new Error('Failed to save contact information.');
            }
            
            // 2. Create booking
            const { data: bookingData, error: bookingError } = await supabase
                .from('bookings')
                .insert({
                    booking_reference: bookingRef,
                    contact_person_id: contactData.id,
                    total_amount: totalAmount,
                    ticket_quantity: ticketQuantity,
                    payment_status: 'pending',
                    created_at: new Date().toISOString()
                })
                .select()
                .single();
            
            if (bookingError) {
                console.error('Booking save error:', bookingError);
                throw new Error('Failed to create booking.');
            }
            
            currentBookingId = bookingData.id;
            
            // 3. Save participants
            const participantsToInsert = participants.map(participant => ({
                booking_id: currentBookingId,
                full_name: participant.name,
                ic_number: participant.icNumber,
                age: parseInt(participant.age),
                created_at: new Date().toISOString()
            }));
            
            const { error: participantsError } = await supabase
                .from('participants')
                .insert(participantsToInsert);
            
            if (participantsError) {
                console.error('Participants save error:', participantsError);
                throw new Error('Failed to save participant details.');
            }
            
            // Update payment page with info
            paymentNameElement.textContent = contactName;
            paymentReferenceElement.textContent = bookingRef;
            
            // Go to payment page
            goToPage(4);
            
        } catch (error) {
            console.error('Error saving booking:', error);
            alert(`Error: ${error.message}. Please try again.`);
        } finally {
            // Reset button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }
    
    // Page 4: Payment
    function selectPayment(method) {
        selectedPayment = method;
        
        // Update UI
        document.querySelectorAll('.payment-method').forEach(el => {
            el.classList.remove('selected');
        });
        
        event.currentTarget.classList.add('selected');
    }
    
    // Updated processPayment function with database integration
    async function processPayment() {
        const bookingRef = paymentReferenceElement.textContent;
        const totalAmount = ticketQuantity * ticketPrice;
        const contactName = document.getElementById('contactName').value;
        
        // Show loading state
        const payBtn = document.querySelector('[onclick="processPayment()"]');
        const originalText = payBtn.innerHTML;
        payBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        payBtn.disabled = true;
        
        try {
            // In a real implementation, you would integrate with actual payment gateway here
            // For now, we'll simulate payment success
            
            // Check if we have a booking ID
            if (!currentBookingId) {
                // Try to find booking by reference
                const { data: bookingData, error: fetchError } = await supabase
                    .from('bookings')
                    .select('id')
                    .eq('booking_reference', bookingRef)
                    .single();
                
                if (fetchError) throw new Error('Booking not found.');
                currentBookingId = bookingData.id;
            }
            
            // Update booking status to "paid"
            const { error: updateError } = await supabase
                .from('bookings')
                .update({
                    payment_status: 'paid',
                    payment_method: selectedPayment,
                    payment_date: new Date().toISOString(),
                    payment_reference: `PAY-${Date.now()}`
                })
                .eq('id', currentBookingId);
            
            if (updateError) {
                console.error('Booking update error:', updateError);
                throw new Error('Failed to update payment status.');
            }
            
            // Record payment transaction
            const { error: transactionError } = await supabase
                .from('payment_transactions')
                .insert({
                    booking_id: currentBookingId,
                    amount: totalAmount,
                    payment_method: selectedPayment,
                    transaction_id: `TXN-${Date.now()}`,
                    status: 'completed',
                    gateway_response: { simulated: true, method: selectedPayment },
                    created_at: new Date().toISOString()
                });
            
            if (transactionError) {
                console.error('Transaction save error:', transactionError);
                throw new Error('Failed to record payment transaction.');
            }
            
            // Send confirmation email (simulated)
            await sendConfirmationEmail(bookingRef, contactName);
            
            // Update confirmation page
            const now = new Date();
            confirmationContactElement.textContent = contactName;
            confirmationDateElement.textContent = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            confirmationBookingRefElement.textContent = bookingRef;
            confirmationRefElement.textContent = bookingRef;
            
            // Render participants summary
            renderParticipantsSummary();
            
            // Go to confirmation page
            goToPage(5);
            
        } catch (error) {
            console.error('Payment processing error:', error);
            alert(`Payment Error: ${error.message}. Please contact support if the issue persists.`);
        } finally {
            // Reset button state
            payBtn.innerHTML = originalText;
            payBtn.disabled = false;
        }
    }
    
    // REAL PAYMENT INTEGRATION OPTIONS - CHOOSE ONE
    
    // Option 1: Stripe Integration (International Cards)
    async function processStripePayment() {
        // Load Stripe.js if not already loaded
        if (!window.Stripe) {
            const script = document.createElement('script');
            script.src = 'https://js.stripe.com/v3/';
            document.head.appendChild(script);
            script.onload = () => initializeStripePayment();
        } else {
            initializeStripePayment();
        }
        
        async function initializeStripePayment() {
            const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY'); // Replace with your key
            const totalAmount = ticketQuantity * ticketPrice;
            const contactName = document.getElementById('contactName').value;
            const contactEmail = document.getElementById('contactEmail').value;
            
            // Create payment intent (in production, call your backend)
            try {
                // This should be a call to your backend API
                const response = await fetch('https://your-backend.com/create-payment-intent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${supabaseKey}`
                    },
                    body: JSON.stringify({
                        amount: Math.round(totalAmount * 100), // Convert to cents
                        currency: 'myr',
                        bookingId: currentBookingId,
                        metadata: {
                            booking_reference: paymentReferenceElement.textContent,
                            contact_name: contactName,
                            contact_email: contactEmail
                        }
                    })
                });
                
                const { clientSecret, error: intentError } = await response.json();
                
                if (intentError) throw new Error(intentError.message);
                
                // Confirm payment
                const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
                    payment_method: {
                        card: cardElement, // You need to create a card element
                        billing_details: {
                            name: contactName,
                            email: contactEmail
                        }
                    }
                });
                
                if (error) {
                    alert(`Payment failed: ${error.message}`);
                } else {
                    // Payment successful - update database
                    await updatePaymentStatus(paymentIntent.id, 'stripe');
                    goToPage(5);
                }
                
            } catch (error) {
                console.error('Stripe payment error:', error);
                alert('Payment processing error. Please try again.');
            }
        }
    }
    
    // Option 2: Razerpay Integration (Malaysia)
    async function processRazerpayPayment() {
        // Load Razerpay if not already loaded
        if (!window.Razorpay) {
            const script = document.createElement('script');
            script.src = 'https://checkout.razorpay.com/v1/checkout.js';
            document.head.appendChild(script);
            script.onload = () => initializeRazerpayPayment();
        } else {
            initializeRazerpayPayment();
        }
        
        async function initializeRazerpayPayment() {
            const totalAmount = ticketQuantity * ticketPrice;
            const contactName = document.getElementById('contactName').value;
            const contactEmail = document.getElementById('contactEmail').value;
            const contactPhone = document.getElementById('contactPhone').value;
            
            const options = {
                key: 'YOUR_RAZERPAY_KEY_ID', // Replace with your key
                amount: Math.round(totalAmount * 100), // Amount in paise
                currency: 'MYR',
                name: 'Young Scientist Day 2026 UPM',
                description: `Ticket booking for ${ticketQuantity} participant(s)`,
                image: 'https://your-logo-url.com/logo.png', // Your logo
                handler: async function(response) {
                    // Verify payment on your backend
                    try {
                        const verifyResponse = await fetch('https://your-backend.com/verify-razorpay', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${supabaseKey}`
                            },
                            body: JSON.stringify({
                                razorpay_payment_id: response.razorpay_payment_id,
                                razorpay_order_id: response.razorpay_order_id,
                                razorpay_signature: response.razorpay_signature,
                                bookingId: currentBookingId,
                                amount: totalAmount
                            })
                        });
                        
                        const result = await verifyResponse.json();
                        
                        if (result.success) {
                            await updatePaymentStatus(response.razorpay_payment_id, 'razorpay');
                            goToPage(5);
                        } else {
                            alert('Payment verification failed. Please contact support.');
                        }
                    } catch (error) {
                        console.error('Verification error:', error);
                        alert('Payment verification error. Please contact support.');
                    }
                },
                prefill: {
                    name: contactName,
                    email: contactEmail,
                    contact: contactPhone.replace(/[^0-9]/g, '') // Clean phone number
                },
                notes: {
                    booking_reference: paymentReferenceElement.textContent,
                    participants: ticketQuantity.toString()
                },
                theme: {
                    color: '#2c6cb0'
                }
            };
            
            const rzp = new Razerpay(options);
            rzp.open();
        }
    }
    
    // Option 3: Billplz Integration (Malaysia - FPX/Bank Transfer)
    async function processBillplzPayment() {
        const totalAmount = ticketQuantity * ticketPrice;
        const contactName = document.getElementById('contactName').value;
        const contactEmail = document.getElementById('contactEmail').value;
        const contactPhone = document.getElementById('contactPhone').value;
        
        try {
            // Create bill in Billplz
            const response = await fetch('https://your-backend.com/create-billplz-bill', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${supabaseKey}`
                },
                body: JSON.stringify({
                    amount: totalAmount,
                    name: contactName,
                    email: contactEmail,
                    mobile: contactPhone,
                    description: `YSD2026 Ticket - ${ticketQuantity} participant(s)`,
                    callback_url: `${window.location.origin}/payment-callback.html`,
                    redirect_url: `${window.location.origin}/confirmation.html`,
                    metadata: {
                        booking_reference: paymentReferenceElement.textContent,
                        booking_id: currentBookingId
                    }
                })
            });
            
            const { bill_url, id } = await response.json();
            
            // Redirect to Billplz payment page
            window.location.href = bill_url;
            
        } catch (error) {
            console.error('Billplz error:', error);
            alert('Failed to initialize payment. Please try again.');
        }
    }
    
    // Helper function to update payment status in database
    async function updatePaymentStatus(transactionId, method) {
        try {
            const bookingRef = paymentReferenceElement.textContent;
            const totalAmount = ticketQuantity * ticketPrice;
            
            // Update booking
            const { error: bookingError } = await supabase
                .from('bookings')
                .update({
                    payment_status: 'paid',
                    payment_method: method,
                    payment_date: new Date().toISOString(),
                    payment_reference: transactionId
                })
                .eq('booking_reference', bookingRef);
            
            if (bookingError) throw bookingError;
            
            // Record transaction
            const { error: transactionError } = await supabase
                .from('payment_transactions')
                .insert({
                    booking_id: currentBookingId,
                    amount: totalAmount,
                    payment_method: method,
                    transaction_id: transactionId,
                    status: 'completed',
                    created_at: new Date().toISOString()
                });
            
            if (transactionError) throw transactionError;
            
            // Send confirmation email
            const contactName = document.getElementById('contactName').value;
            await sendConfirmationEmail(bookingRef, contactName);
            
            return true;
        } catch (error) {
            console.error('Update payment error:', error);
            throw error;
        }
    }
    
    // Send confirmation email
    async function sendConfirmationEmail(bookingRef, contactName) {
        // This would be implemented with your email service
        // Example using Supabase Edge Functions or your own backend
        
        try {
            const response = await fetch('https://your-backend.com/send-confirmation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${supabaseKey}`
                },
                body: JSON.stringify({
                    to: document.getElementById('contactEmail').value,
                    subject: `YSD2026 Ticket Confirmation - ${bookingRef}`,
                    template: 'confirmation',
                    data: {
                        name: contactName,
                        booking_ref: bookingRef,
                        date: new Date().toLocaleDateString('en-MY'),
                        participants: participants,
                        total_amount: ticketQuantity * ticketPrice,
                        event_date: '13th June 2026',
                        venue: 'Universiti Putra Malaysia'
                    }
                })
            });
            
            console.log('Confirmation email sent');
            return true;
        } catch (error) {
            console.error('Email error:', error);
            // Don't throw error here - email failure shouldn't block confirmation
            return false;
        }
    }
    
    function renderParticipantsSummary() {
        participantsSummary.innerHTML = '<h4>Participants Summary (for certificate preparation):</h4>';
        
        participants.forEach(participant => {
            const participantItem = document.createElement('div');
            participantItem.className = 'preview-item';
            participantItem.innerHTML = `
                <span class="preview-label">Participant ${participant.id}:</span>
                <span class="preview-value">${participant.name} (IC: ${participant.icNumber}, Age: ${participant.age})</span>
            `;
            participantsSummary.appendChild(participantItem);
        });
    }
    
    // Page 5: Confirmation
    async function printTicket() {
        // Fetch latest booking data for print
        try {
            const { data: bookingData, error } = await supabase
                .from('bookings')
                .select(`
                    *,
                    contact_persons (*),
                    participants (*)
                `)
                .eq('booking_reference', confirmationBookingRefElement.textContent)
                .single();
            
            if (error) throw error;
            
            const contact = bookingData.contact_persons;
            const participantsList = bookingData.participants;
            
            const printContent = `
                <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px;">
                    <h2 style="color: #2c3e50; text-align: center;">ADMISSION TICKET YSD2026 UPM</h2>
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Event Details</h3>
                    <p><strong>Event:</strong> Young Scientist Day 2026</p>
                    <p><strong>Date:</strong> 13th June 2026</p>
                    <p><strong>Venue:</strong> Universiti Putra Malaysia</p>
                    <p><strong>Time:</strong> 9:00 AM - 5:00 PM</p>
                    
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Booking Information</h3>
                    <p><strong>Booking Reference:</strong> ${bookingData.booking_reference}</p>
                    <p><strong>Contact Person:</strong> ${contact.full_name}</p>
                    <p><strong>Contact Email:</strong> ${contact.email}</p>
                    <p><strong>Contact Phone:</strong> ${contact.phone}</p>
                    <p><strong>Date Purchased:</strong> ${new Date(bookingData.created_at).toLocaleDateString('en-MY')}</p>
                    <p><strong>Number of Participants:</strong> ${bookingData.ticket_quantity}</p>
                    <p><strong>Total Amount Paid:</strong> RM ${parseFloat(bookingData.total_amount).toFixed(2)}</p>
                    <p><strong>Payment Status:</strong> ${bookingData.payment_status.toUpperCase()}</p>
                    
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Participants</h3>
                    ${participantsList.map((p, index) => `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                            <p><strong>Participant ${index + 1}:</strong> ${p.full_name}</p>
                            <p><strong>IC/Passport:</strong> ${p.ic_number} | <strong>Age:</strong> ${p.age}</p>
                        </div>
                    `).join('')}
                    
                    <hr style="margin: 15px 0;">
                    
                    <div style="background-color: #e3f2fd; padding: 15px; border-radius: 5px; margin: 20px 0;">
                        <h4 style="color: #1565c0; margin-top: 0;">Important Instructions:</h4>
                        <ol style="margin-bottom: 0;">
                            <li>Please present this ticket at the registration counter</li>
                            <li>Bring original IC/passport for verification</li>
                            <li>Arrive 30 minutes before the event starts</li>
                            <li>Certificates will be distributed at the end of the event</li>
                        </ol>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <p style="font-size: 0.9rem; color: #666;">Young Scientist Day 2026 | Universiti Putra Malaysia</p>
                        <p style="font-size: 0.8rem; color: #999;">For inquiries: ysd2026@upm.edu.my | +603-9769 1234</p>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>YSD2026 Ticket - ${bookingData.booking_reference}</title>
                    <style>
                        @media print {
                            @page { margin: 0; }
                            body { margin: 1.6cm; }
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
            
        } catch (error) {
            console.error('Error fetching booking for print:', error);
            // Fallback to local data if API fails
            const fallbackPrintContent = `
                <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px;">
                    <h2 style="color: #2c3e50; text-align: center;">ADMISSION TICKET YSD2026 UPM</h2>
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Event Details</h3>
                    <p><strong>Event:</strong> Young Scientist Day 2026</p>
                    <p><strong>Date:</strong> 13th June 2026</p>
                    <p><strong>Venue:</strong> Universiti Putra Malaysia</p>
                    
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Contact Person</h3>
                    <p><strong>Name:</strong> ${confirmationContactElement.textContent}</p>
                    <p><strong>Booking Reference:</strong> ${confirmationBookingRefElement.textContent}</p>
                    <p><strong>Date Purchased:</strong> ${confirmationDateElement.textContent}</p>
                    <p><strong>Number of Participants:</strong> ${confirmationQuantityElement.textContent}</p>
                    
                    <hr style="margin: 15px 0;">
                    
                    <h3 style="color: #2c6cb0;">Participants</h3>
                    ${participants.map(p => `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                            <p><strong>Participant ${p.id}:</strong> ${p.name}</p>
                            <p><strong>IC/Passport:</strong> ${p.icNumber} | <strong>Age:</strong> ${p.age}</p>
                        </div>
                    `).join('')}
                    
                    <hr style="margin: 15px 0;">
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <p style="font-size: 0.9rem; color: #666;">Present this ticket at the event entrance on 13th June 2026</p>
                        <p style="font-size: 0.8rem; color: #999;">All participant data is stored securely and will be used for certificate preparation</p>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>YSD2026 Ticket - ${confirmationBookingRefElement.textContent}</title>
                </head>
                <body>${fallbackPrintContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
    }
    
    // Handle quantity input change
    quantityInput.addEventListener('change', function() {
        if (this.value < 1) this.value = 1;
        if (this.value > 10) this.value = 10;
        ticketQuantity = parseInt(this.value);
        updateTotalAmount();
        
        // Update participant forms if we're on page 3
        if (currentPage === 3) {
            updateParticipantForms();
        }
    });
    
    // Add input event listeners for real-time validation
    document.getElementById('contactEmail')?.addEventListener('blur', function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (this.value && !emailRegex.test(this.value)) {
            alert('Please enter a valid email address.');
            this.focus();
        }
    });
    
    // Add this to track page visits (analytics)
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible' && currentPage === 5) {
            // User returned to confirmation page - refresh data if needed
            console.log('User returned to confirmation page');
        }
    });
</script>
</body>
</html>
